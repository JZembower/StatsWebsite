<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SPM Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.16.9/xlsx.full.min.js"></script>
    <script>
        let data1, data2;

        function uploadFile1() {
            const fileInput = document.getElementById('fileInput1');
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                data1 = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                populateColumnSelection(data1, 'colLeft');
                checkFilesUploaded();
            };
            reader.readAsArrayBuffer(file);
        }

        function uploadFile2() {
            const fileInput = document.getElementById('fileInput2');
            const file = fileInput.files[0];
            const reader = new FileReader();
            reader.onload = function(event) {
                const data = new Uint8Array(event.target.result);
                const workbook = XLSX.read(data, {type: 'array'});
                data2 = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
                populateColumnSelection(data2, 'colRight');
                checkFilesUploaded();
            };
            reader.readAsArrayBuffer(file);
        }

        function populateColumnSelection(data, selectId) {
            const select = document.getElementById(selectId);
            select.innerHTML = '';
            const columns = Object.keys(data[0]);
            columns.forEach(column => {
                const option = document.createElement('option');
                option.value = column;
                option.textContent = column;
                select.appendChild(option);
            });
        }

        function checkFilesUploaded() {
            if (data1 && data2) {
                document.getElementById('columnSelection').style.display = 'block';
            }
        }

        function runAnalysis() {
            const colLeft = document.getElementById('colLeft').value;
            const colRight = document.getElementById('colRight').value;
            const values1 = data1.map(row => row[colLeft]);
            const values2 = data2.map(row => row[colRight]);
            overlayValues(values1, values2);
        }

        function overlayValues(values1, values2) {
            const output = document.getElementById('output');
            output.innerHTML = '<h3>Overlayed Values</h3>';
            const table = document.createElement('table');
            const headerRow = document.createElement('tr');
            const header1 = document.createElement('th');
            header1.textContent = 'Dataset 1';
            const header2 = document.createElement('th');
            header2.textContent = 'Dataset 2';
            headerRow.appendChild(header1);
            headerRow.appendChild(header2);
            table.appendChild(headerRow);

            for (let i = 0; i < Math.min(values1.length, values2.length); i++) {
                const row = document.createElement('tr');
                const cell1 = document.createElement('td');
                cell1.textContent = values1[i];
                const cell2 = document.createElement('td');
                cell2.textContent = values2[i];
                row.appendChild(cell1);
                row.appendChild(cell2);
                table.appendChild(row);
            }

            output.appendChild(table);
        }
    </script>
</head>
<body>
    <h1>SPM Analysis</h1>
    <input type="file" id="fileInput1" accept=".csv, .xlsx">
    <button onclick="uploadFile1()">Upload File 1</button>
    <input type="file" id="fileInput2" accept=".csv, .xlsx">
    <button onclick="uploadFile2()">Upload File 2</button>
    <div id="columnSelection" style="display: none;">
        <h3>Select Columns</h3>
        <select id="colLeft"></select>
        <select id="colRight"></select>
        <button onclick="runAnalysis()">Run Analysis</button>
    </div>
    <div id="output"></div>
</body>
</html>
